{% extends "base.html" %}
{% load correction_tags %}

{% block form %}

	<!-- https://materializecss.com/tooltips.html -->
	<script type="text/javascript">
		$(document).ready(function(){
			$('.tooltipped').tooltip();
			$('.dropdown-trigger').dropdown();
		});

		var topics = {{topics|safe}};
		function filter_topic(filter) {
			// https://stackoverflow.com/questions/4644673/hide-all-elements-with-class-using-plain-javascript
			document.querySelectorAll('.doc-preview').forEach(function(el) {
				el.style.display = "none";
			});
			for (var item in topics[filter]) {
				document.getElementById(topics[filter][item]).style.display = "block";
			}
		}
	</script>

	<div class="row">
	</div>

	<div class="row">
		<div class="col s12">
			{% if topics %}
				<a class='dropdown-trigger btn right' href='#' data-target='topic-dropdown'>Filter by Topic</a>

				<!-- Dropdown Structure -->
				<ul id='topic-dropdown' class='dropdown-content'>
					{% for topic in topics %}
						<li><a href="#!" onclick="filter_topic('{{topic}}')">{{topic}}</a></li>
					{% endfor %}
				</ul>
			{% endif %}

			{% if not documents.items %}
				<h5>No results</h5>
			{% endif %}
			{% if corrections %}
				{% for word,replacements in corrections.items %}
					<p>You tried: <b>{{ word }}</b>. Did you mean:
					{% for possibility in replacements %}
						<a href="?{% word_replace word possibility %}">{{possibility}}</a> 
					{% endfor %}
					</p>
				{% endfor %}
			{% endif %}

			{% for id,doc in documents.items %}
				<div class="section doc-preview" id="{{id}}">
					<h5>
						<a
							{% if doc.1 %}
								class="tooltipped" data-position="top" data-tooltip="Score: {{doc.1|floatformat:'3'}}"
							{% endif %} 
							href="/document/{{collection}}/{{id}}">{{doc.0.title}}
						</a>
					</h5>
					{% if doc.0.body %}
						<p>
							{{doc.0.body|slice:100}}
							{% if doc.0.body|length > 100 %}
								...
							{% endif %}
						</p>

					{% endif %}
					<div class="divider"></div>
				</div>
			{% endfor %}
		</div>
	</div>
{% endblock %}
